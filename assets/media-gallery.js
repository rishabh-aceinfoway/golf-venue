import PhotoSwipeLightbox from"photoswipe-lightbox";import{debounce,getObjectFitSize}from"utils";class MediaGallery extends HTMLElement{#t;#e;#i;#n;#s;constructor(){super(),this.#i=this.#a.bind(this),this.#n=this.#o.bind(this)}connectedCallback(){this.carousel=this.querySelector("media-carousel"),this.navigation=this.querySelector("media-gallery-navigation"),this.navigationThumbList=this.navigation?.querySelector(".js-media-gallery-thumb-list"),this.navigationPrevious=this.navigation?.querySelector(".js-media-gallery-nav-prev"),this.navigationNext=this.navigation?.querySelector(".js-media-gallery-nav-next"),this.viewInSpaceButton=this.querySelector(".js-product-view-in-space-btn"),this.classList.remove("media-gallery--loading"),this.carousel&&(void 0!==this.carousel.index?this.#r():this.carousel.addEventListener("on:media-carousel:init",(()=>{this.#r()}),{once:!0})),this.dataset.zoom&&this.#l()}disconnectedCallback(){this.#t&&this.#t.disconnect(),this.#e&&this.#e.disconnect(),this.carousel.off("on:media-carousel:slide-change",this.#i).off("on:media-carousel:slide-change",this.#n).off("on:media-carousel:slide-change",MediaGallery.#d).off("on:media-carousel:before-slide-change",MediaGallery.#h),this.#s&&this.#s.destroy()}goToSlide(t){const e=this.carousel?.querySelector(`[data-media-id="${t}"]`).dataset.slideId;e&&this.carousel.slideTo(Number(e),200)}#r(){const[t,e]=(this.dataset.thumbnailsSize||"70:70").split(":"),i=Number(t),n=Number(e);if(this.navigationThumbList){const t=this.carousel.index;if(this.navigationThumbList.children[t].classList.add("thumbnail-list__item--active"),this.navigationThumbList.children[t].querySelector(".thumbnail").setAttribute("aria-current","true"),"ResizeObserver"in window)this.#t=new ResizeObserver(debounce((t=>{t.forEach((t=>{const e=t.target.querySelector(".thumbnail-list__item--active");this.#c(i,n),this.#u(e),this.#g()}))}),50)),this.#t.observe(this.navigationThumbList),this.#e=new ResizeObserver(debounce((t=>{t.forEach((()=>{this.#c(i,n)}))}),100)),this.#e.observe(this.carousel);else{const t=this.navigation.querySelector(".thumbnail-list__item--active");this.#c(i,n),this.#u(t),this.#g()}Array.from(this.navigation.querySelectorAll(".thumbnail")).forEach((t=>{t.addEventListener("click",(t=>{const e=Number(t.target.dataset.slideNumber);this.carousel.slideTo(e,200)}))}))}this.navigationThumbList&&this.navigationPrevious&&this.navigationNext&&this.#m(),this.carousel.on("on:media-carousel:slide-change",this.#i).on("on:media-carousel:slide-change",this.#n).on("on:media-carousel:slide-change",MediaGallery.#d).on("on:media-carousel:before-slide-change",MediaGallery.#h)}#l(){const t=Array.from(this.querySelectorAll((this.carousel?".js-slides":"")+" .media-gallery__link")).map((t=>({id:t.dataset.slideId,src:t.href,width:t.dataset.pswpWidth,height:t.dataset.pswpHeight}))),e=document.getElementById("template-icon-close").content.cloneNode(!0).firstElementChild;e.classList.add("pswp__icn");const i=document.getElementById("template-icon-chevron").content.cloneNode(!0).firstElementChild;i.classList.add("pswp__icn");const n=document.getElementById("template-icon-chevron").content.cloneNode(!0).firstElementChild;n.classList.add("pswp__icn","icon--left");const s=document.getElementById("template-media-gallery-zoom-icon").content.cloneNode(!0).firstElementChild;s.classList.add("pswp__icn"),this.#s=new PhotoSwipeLightbox({arrowPrevSVG:n.outerHTML,arrowNextSVG:i.outerHTML,zoomSVG:s.outerHTML,closeSVG:e.outerHTML,counter:!1,dataSource:t,bgOpacity:1,pswpModule:()=>import("photoswipe")}),this.#s.init(),this.#s.addFilter("thumbBounds",((t,e)=>{const i=(this.carousel||this).querySelector(`[data-slide-id="${e.id}"] img`),n=i.getBoundingClientRect(),s=getObjectFitSize(!0,i.width,i.height,i.naturalWidth,i.naturalHeight);return{x:n.left+n.width/2-s.width/2,y:n.top+n.height/2-s.height/2,w:s.width}})),this.#s.addFilter("thumbEl",((t,e)=>{const i=(this.carousel||this).querySelector(`[data-slide-id="${e.id}"] img`);return i||t})),this.#s.addFilter("placeholderSrc",((t,e)=>{const i=(this.carousel||this).querySelector(`[data-slide-id="${e.data.id}"] img`);return i?i.src:t})),this.carousel&&this.#s.on("change",(()=>{const t=this.#s.pswp.currSlide,{id:e}=t.data;e&&this.carousel.slideTo(Number(e))}));const a=(t=>{t.preventDefault();const e=t.target.closest(".media-gallery__item")?.dataset.imageSlideIndex;Number(e)>=0&&this.#s.loadAndOpen(Number(e))}).bind(this);this.carousel?(this.carousel.initialized?this.carousel.currentSlide.querySelector(".media-gallery__link")?.addEventListener("click",a):this.carousel.addEventListener("on:media-carousel:init",(()=>{this.carousel.currentSlide.querySelector(".media-gallery__link")?.addEventListener("click",a)}),{once:!0}),this.carousel.addEventListener("on:media-carousel:slide-change",(({detail:{currentSlide:t,previousSlide:e}})=>{const i=e?.querySelector(".media-gallery__link");i&&i.removeEventListener("click",a);const n=t.querySelector(".media-gallery__link");n&&n.addEventListener("click",a)}))):this.querySelectorAll(".media-gallery__link").forEach((t=>{t.addEventListener("click",a)}))}#b(){return this.classList.contains("media-gallery--thumbnails-aside")&&window.matchMedia("(min-width: 768px)").matches}#u(t,e="instant"){if(!this.navigationThumbList)return;const i=this.#b(),n=i?"height":"width",s=i?"top":"left",a=i?"bottom":"right",o=i?"marginTop":"marginLeft",r=i?"marginBottom":"marginRight",l=Number(window.getComputedStyle(t)[o].replace("px","")),d=Number(window.getComputedStyle(t)[r].replace("px","")),h=l+t.getBoundingClientRect()[n]+d,c=this.navigationThumbList.getBoundingClientRect()[s]+h>t.getBoundingClientRect()[a]+d,u=!c&&this.navigationThumbList.getBoundingClientRect()[a]-h<t.getBoundingClientRect()[s]-l;let g=0;c&&(g=t.getBoundingClientRect()[s]-l-this.navigationThumbList.getBoundingClientRect()[s]),u&&(g=t.getBoundingClientRect()[a]+d-this.navigationThumbList.getBoundingClientRect()[a]);const m=t.previousSibling;if(m){const e=Number(window.getComputedStyle(t)[o].replace("px","")),i=Number(window.getComputedStyle(t)[r].replace("px","")),l=e+m.getBoundingClientRect()[n]+i;this.navigationThumbList.getBoundingClientRect()[s]+l>m.getBoundingClientRect()[a]+i+1&&(g=m.getBoundingClientRect()[s]-e-this.navigationThumbList.getBoundingClientRect()[s])}const b=t.nextSibling;if(b){const e=Number(window.getComputedStyle(t)[o].replace("px","")),i=Number(window.getComputedStyle(t)[r].replace("px","")),l=e+b.getBoundingClientRect()[n]+i;this.navigationThumbList.getBoundingClientRect()[a]-l<b.getBoundingClientRect()[s]-e&&(g=b.getBoundingClientRect()[a]+i-this.navigationThumbList.getBoundingClientRect()[a])}g&&this.navigationThumbList.scrollBy({top:i?g:0,left:i?0:g,behavior:e}),this.navigation?.classList.remove("media-gallery__nav--loading"),this.navigation?.classList.add("is-loaded")}#g(){if(!this.navigationThumbList||!this.navigationPrevious||!this.navigationNext)return;const t=this.#b(),e=t?"scrollHeight":"scrollWidth",i=t?"clientHeight":"clientWidth";this.navigationThumbList[e]>this.navigationThumbList[i]?(this.navigationPrevious.removeAttribute("hidden"),this.navigationNext.removeAttribute("hidden")):(this.navigationPrevious.setAttribute("hidden",""),this.navigationNext.setAttribute("hidden",""))}#m(){if(!this.navigationThumbList)return;const t={root:this.navigationThumbList,rootMargin:"2px",threshold:1};this.#g(),this.navigationPrevious.addEventListener("click",(()=>{const t=this.#b();this.navigationThumbList.scrollBy({top:t?0-this.navigationThumbList.getBoundingClientRect().height:0,left:t?0:0-this.navigationThumbList.getBoundingClientRect().width,behavior:"smooth"})})),this.navigationNext.addEventListener("click",(()=>{const t=this.#b();this.navigationThumbList.scrollBy({top:t?this.navigationThumbList.getBoundingClientRect().height:0,left:t?0:this.navigationThumbList.getBoundingClientRect().width,behavior:"smooth"})}));const e=t=>{t.forEach((t=>{const e=this.navigationThumbList.getBoundingClientRect(),i=t.target.getBoundingClientRect(),n=this.#b(),s=n?"height":"width",a=n?"top":"left",o=n?"bottom":"right";e[a]+i[s]>=i[o]&&(t.isIntersecting?this.navigationPrevious.setAttribute("disabled",""):this.navigationPrevious.removeAttribute("disabled")),e[o]-i[s]<=i[a]&&(t.isIntersecting?this.navigationNext.setAttribute("disabled",""):this.navigationNext.removeAttribute("disabled"))}))};if(this.navigationThumbList.children.length>3){const i=new IntersectionObserver(e,t);i.observe(this.navigationThumbList.children[0]),i.observe(this.navigationThumbList.children[this.navigationThumbList.children.length-1])}}#v(t=70,e=300){const i=Number(window.getComputedStyle(this.navigationThumbList).gap.split(" ")[0].replace("px","")),n=this.navigationThumbList.getBoundingClientRect()[this.#b()?"height":"width"],s=Math.floor(t/10),a=e=>{const n=Math.floor(e/(t+i-s)),a=Math.floor(e/(t+i+s)),o=a>n?a:n;return o>2?o:3};return a(n<=e?e:n)}#c(t=70,e=70){if(!this.navigationThumbList)return;const i=this.#b();this.navigationThumbList.style.setProperty("--thumbRatio",this.#v(i?e:t)),i?this.navigationThumbList.style.setProperty("--justify","start"):this.navigationThumbList.style.setProperty("--justify",this.navigationThumbList.scrollWidth>this.navigationThumbList.clientWidth?"start":"center");const n=this.navigation.closest(".js-product-slider-nav");n&&!n.classList.contains("is-loaded")&&n.classList.add("is-loaded")}#a({detail:{activeIndex:t}}){if(!this.navigationThumbList)return;const e=this.navigationThumbList.querySelector(".thumbnail-list__item--active"),i=this.navigationThumbList.children[t];e.classList.remove("thumbnail-list__item--active"),e.querySelector(".thumbnail").removeAttribute("aria-current"),i.classList.add("thumbnail-list__item--active"),i.querySelector(".thumbnail").setAttribute("aria-current","true"),this.#u(i,"smooth")}#o({detail:{currentSlide:t}}){if(!this.viewInSpaceButton)return;const e=t?.querySelector(".media-gallery__item--model");e&&(this.viewInSpaceButton.dataset.shopifyModel3dId=e.dataset.mediaId)}static#d({detail:{currentSlide:t}}){const e=t?.querySelector(".deferred-media, video-player");e&&(e.hasAttribute("loaded")?"PRODUCT-MODEL"===e.tagName?e.querySelector("model-viewer")?.play():"VIDEO-PLAYER"===e.tagName&&e.play():("PRODUCT-MODEL"===e.tagName&&e.addEventListener("on:product-model:loaded",(()=>{t.classList.add("swiper-no-swiping")}),{once:!0}),"VIDEO-PLAYER"===e.tagName&&e.play(),e.loadContent()))}static#h({detail:{previousSlide:t}}){const e=t?.querySelector(".deferred-media, video-player");"PRODUCT-MODEL"===e?.tagName&&e?.querySelector("model-viewer")?.pause(),"VIDEO-PLAYER"===e?.tagName&&e.pause()}}customElements.define("media-gallery",MediaGallery);
//# sourceMappingURL=media-gallery.js.map

