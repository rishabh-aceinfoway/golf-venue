import{animate,glide,inView,stagger}from"motion";import{ANIMATION_LOAD,ANIMATION_INTERVAL,ANIMATION_INTERVAL_STYLE}from"store-data";import{debounce}from"utils";const ALLOWED_SETTINGS_KEYS=["amount","delay","displacement","duration","interval","scale","selector"];class Animations{#t;#e;#a;#i;#n;#o;#s=0;static#r=!1;constructor(t=10,e=.5,a=ANIMATION_INTERVAL){if(Animations.#r)throw new Error("Animations instance already exists");Animations.#r=!0,ANIMATION_LOAD&&(this.#n=window.matchMedia("(prefers-reduced-motion: reduce)"),this.#e="fade_in"!==ANIMATION_INTERVAL_STYLE?t:0,this.#a=e,this.#i=a,this.#o=window.scrollY||document.documentElement.scrollTop,this.#t=this.#l.bind(this),this.setup(),Animations.#m(),window.addEventListener("scroll",debounce(this.#t,16)),window.addEventListener("scrollend",this.#t))}setupSingle(t){if(!ANIMATION_LOAD)return;if(!t)throw new Error("Element must be provided for animation");let e=t.dataset.animationAmount?Number(t.dataset.animationAmount):0;e<0?e=0:e>=1&&(e=.99);const a={delay:t.dataset.animationDelay?parseFloat(t.dataset.animationDelay):0,displacement:(t.dataset.animationDisplacement?Number(t.dataset.animationDisplacement):this.#e)*("fade_down"===ANIMATION_INTERVAL_STYLE?-1:1),duration:t.dataset.animationDuration?parseFloat(t.dataset.animationDuration):this.#a,scale:t.dataset.animationScale?parseFloat(t.dataset.animationScale):1},i=`matrix(${a.scale}, 0, 0, ${a.scale}, 0, ${a.displacement})`;t.style.setProperty("opacity",0),t.style.setProperty("transform",i),inView(t,(e=>{const{target:n}=e,o=animate(n,{opacity:1,transform:"matrix(1, 0, 0, 1, 0, 0)"},{autoplay:!1,delay:a.delay,duration:this.#n.matches?0:a.duration,easing:glide()});return o.play(),o.finished.then((()=>{n.classList.add("js-animation-done"),n.style.removeProperty("opacity"),n.style.removeProperty("transform")})),t.animations=[{animation:o,transformSettings:{elements:[n],transform:i}}],()=>{t.dataset.animationReplay&&(o.cancel(),n.classList.remove("js-animation-done"),n.style.setProperty("opacity",0),n.style.setProperty("transform",i))}}),{amount:e})}setupSequence(t){if(!ANIMATION_LOAD)return;if(!t)throw new Error("Element must be provided for animation");let e=t.dataset.animationAmount?Number(t.dataset.animationAmount):0;e<0?e=0:e>=1&&(e=.99);const a={delay:t.dataset.animationDelay?parseFloat(t.dataset.animationDelay):0,displacement:(t.dataset.animationDisplacement?Number(t.dataset.animationDisplacement):this.#e)*("fade_down"===ANIMATION_INTERVAL_STYLE?-1:1),duration:t.dataset.animationDuration?parseFloat(t.dataset.animationDuration):this.#a,interval:t.dataset.animationInterval?parseFloat(t.dataset.animationInterval):this.#i,selector:t.dataset.animationSelector,scale:t.dataset.animationScale?parseFloat(t.dataset.animationScale):1},i=t.dataset.animation?JSON.parse(t.dataset.animation).reduce(((t,e)=>[...t,Object.keys(e).filter((t=>ALLOWED_SETTINGS_KEYS.includes(t))).reduce(((t,a)=>(t[a]=e[a],t)),{...a})]),[]):[a],n=[];i.forEach((e=>{const a=e.selector?Array.from(t.querySelectorAll(e.selector)):Array.from(t.children),i=`matrix(${e.scale}, 0, 0, ${e.scale}, 0, ${e.displacement})`;a.forEach((t=>{t.style.setProperty("opacity",0)})),a.forEach((t=>{t.style.setProperty("transform",i)})),n.push({elements:a,transform:i})})),inView(t,(e=>{const{target:a}=e,o=[];return i.forEach(((t,e)=>{const i=t.selector?Array.from(a.querySelectorAll(t.selector)):Array.from(a.children),s=i.reduce(((t,e,a)=>[...t,...Animations.#d(e)?[a]:[]]),[]),r=this.#s<0?s[s.length-1]:s[0],l=animate(i,{opacity:1,transform:"matrix(1, 0, 0, 1, 0, 0)"},{delay:t.interval?stagger(t.interval,{easing:"linear",from:r,start:t.delay}):t.delay,duration:this.#n.matches?0:t.duration,easing:glide()});l.finished.then((()=>{i.forEach((t=>{t.classList.add("js-animation-done"),t.style.removeProperty("opacity"),t.style.removeProperty("transform")}))})),o.push({animation:l,transformSettings:n[e]})})),t.animations=o,()=>{t.dataset.animationReplay&&(t.classList.remove("js-animation-done"),o.forEach((t=>{t.cancel()})),n.forEach((({elements:t,transform:e})=>{t.forEach((t=>{t.classList.remove("js-animation-done"),t.style.setProperty("opacity",0),t.style.setProperty("transform",e)}))})))}}),{amount:e})}setup(t=document){if(ANIMATION_LOAD){if(!t)throw new Error("Element must be provided for animation");t.querySelectorAll(".js-animate-single").forEach((t=>{this.setupSingle(t)})),t.querySelectorAll(".js-animate-sequence").forEach((t=>{this.setupSequence(t)}))}}static#m(){document.body.classList.add("js-theme-loaded"),document.body.classList.remove("js-theme-loading"),setTimeout((()=>{document.body.classList.remove("js-theme-loaded")}),300)}#l(){const t=window.scrollY||document.documentElement.scrollTop;t>this.#o?this.#s=1:t<this.#o?this.#s=-1:this.#s=0,this.#o=t<=0?0:t}static#d(t,e=!1,a={}){const i=t.getBoundingClientRect(),n=window.innerHeight||document.documentElement.clientHeight,o=window.innerWidth||document.documentElement.clientWidth,s={left:0,right:0,top:0,bottom:0,...a};return e?i.top>=-s.top&&i.left>=-s.left&&i.bottom<=n+s.bottom&&i.right<=o+s.right:i.right>=-s.left&&i.bottom>=-s.top&&i.left<=o+s.right&&i.top<=n+s.bottom}static resetAnimations(t){if(!ANIMATION_LOAD)return;if(!t||!t.animations||t.dataset.animationReplay)return;const{animations:e}=t;t.classList.remove("js-animation-done"),e.forEach((({animation:t,transformSettings:{elements:e,transform:a}})=>{t.cancel(),e.forEach((t=>{t.classList.remove("js-animation-done"),t.style.setProperty("opacity",0),t.style.setProperty("transform",a)}))}))}static setRevealedState(t){if(ANIMATION_LOAD&&t)if(t.classList.contains("js-animate-single"))t.style.setProperty("opacity",1),t.style.setProperty("transform","matrix(1, 0, 0, 1, 0, 0)");else if(t.classList.contains("js-animate-sequence")){let e="";if(t.dataset.animationSelector&&(e=t.dataset.animationSelector),t.dataset.animation){const a=JSON.parse(t.dataset.animation);a.selector&&(e=a.selector)}(e?Array.from(t.querySelectorAll(e)):Array.from(t.children)).forEach((t=>{t.style.setProperty("opacity",1),t.style.setProperty("transform","matrix(1, 0, 0, 1, 0, 0)")}))}}}const PageAnimations=new Animations;export default PageAnimations;export{Animations};
//# sourceMappingURL=animations.js.map
