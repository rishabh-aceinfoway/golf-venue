import{debounce}from"utils";class AnnouncementBar extends HTMLElement{#e;constructor(){super(),this.#e=this.#t.bind(this)}connectedCallback(){this.id=this.getAttribute("id"),this.isDismissible=this.hasAttribute("dismissible"),this.isStatic=this.hasAttribute("static"),this.interactions=!0,this.autoplay=this.hasAttribute("autoplay"),this.autoplayDelay=Number(this.getAttribute("autoplay-delay")||"5000"),this.wrapper=this.querySelector(".announcement__bg"),this.carouselContainer=this.querySelector(".announcement__container"),this.carouselWrapper=this.querySelector(".announcement__wrapper"),this.carouselSlides=this.querySelectorAll(".announcement__slides"),this.popups=this.querySelectorAll("popup-dialog"),this.currentSlide=0,this.autoplayInterval=null,this.carouselSlides.length>1&&this.#s(),this.intersectionObserver=new IntersectionObserver(this.handleIntersection.bind(this)),this.textSizeObserver=new ResizeObserver(debounce((()=>{this.#i()})),50),this.mutationObserver=new MutationObserver((()=>{this.handleWindowResize()})),this.isDismissible&&this.#n(),this.handleWindowResize(),window.addEventListener("resize",(()=>{this.handleWindowResize()})),this.observeMutations(),this.setAttribute("loaded",""),this.carouselSlides[this.currentSlide].dataset.active=!0,this.autoplay&&(this.startAutoplay(),this.carouselContainer.addEventListener("mouseenter",(()=>this.stopAutoplay())),this.carouselContainer.addEventListener("mouseleave",(()=>{this.hasAttribute("popup-open")||this.startAutoplay()}))),this.observeSlides(),this.observeSlidesText(),this.popups.length>0&&this.popups.forEach((e=>{e.on("on:popup:opening",this.#e).on("on:popup:closed",this.#e)}))}observeMutations(){this.mutationObserver.observe(this.carouselWrapper,{childList:!0,subtree:!0,characterData:!0})}observeSlides(){this.carouselSlides.forEach((e=>{this.intersectionObserver.observe(e)}))}observeSlidesText(){Array.from(this.querySelectorAll(".announcement__text")).forEach((e=>{this.textSizeObserver.observe(e)}))}handleWindowResize(){const e=window.innerWidth>767;this.#o(),this.isStatic&&e&&!this.slidesWrap?this.staticDisplay=!0:this.staticDisplay=!1,this.#r(),this.#i()}handleScroll(){const e=this.carouselSlides[0].getBoundingClientRect().width;this.currentSlide=Math.round(this.carouselWrapper.scrollLeft/e),this.carouselSlides.forEach(((e,t)=>{t===this.currentSlide?e.setAttribute("data-active",""):e.removeAttribute("data-active")}))}handleIntersection(e){e.forEach((e=>{e.isIntersecting?this.carouselWrapper.addEventListener("scroll",(()=>this.handleScroll())):this.carouselWrapper.removeEventListener("scroll",(()=>this.handleScroll()))}))}disconnectedCallback(){this.staticDisplay||(this.stopAutoplay(),this.carouselPrevBtn?.removeEventListener("click",this.showPrevSlide),this.carouselNextBtn?.removeEventListener("click",this.showNextSlide),this.carouselContainer.removeEventListener("mouseenter",this.stopAutoplay),this.carouselContainer.removeEventListener("mouseleave",this.startAutoplay),this.intersectionObserver.disconnect(),this.textSizeObserver.disconnect()),this.mutationObserver.disconnect(),window.removeEventListener("resize",this.handleWindowResize),this.removeAttribute("loaded"),this.popups.length>0&&this.popups.forEach((e=>{e.off("on:popup:opening",this.#e).off("on:popup:closed",this.#e)}))}showPrevSlide(){0===this.currentSlide?this.moveToSlide(this.carouselSlides.length-1):this.moveToSlide(this.currentSlide-1),this.dispatchEvent(new CustomEvent("on:announcement-bar:slide-change",{detail:{currentSlide:this.currentSlide}}))}showNextSlide(){this.currentSlide===this.carouselSlides.length-1?this.moveToSlide(0):this.moveToSlide(this.currentSlide+1),this.dispatchEvent(new CustomEvent("on:announcement-bar:slide-change",{detail:{currentSlide:this.currentSlide}}))}startAutoplay(){this.interactions&&null===this.autoplayInterval&&(this.setAttribute("scrolling",""),this.autoplayInterval=setInterval((()=>{this.showNextSlide()}),this.autoplayDelay))}stopAutoplay(){this.interactions&&null!==this.autoplayInterval&&(this.removeAttribute("scrolling"),clearInterval(this.autoplayInterval),this.autoplayInterval=null)}moveToSlide(e,t="smooth"){this.carouselWrapper.scrollTo({left:this.carouselSlides[e].offsetLeft,behavior:window.matchMedia("(prefers-reduced-motion: reduce)").matches?"instant":t}),this.currentSlide=e,this.carouselSlides.forEach(((e,t)=>{t===this.currentSlide?e.setAttribute("data-active",""):e.removeAttribute("data-active")}))}moveToSlideById(e,t="smooth"){const s=document.getElementById(e);if(!s)return;const i=[...this.carouselSlides].indexOf(s);i>-1&&this.moveToSlide(i,t)}dismiss(){sessionStorage.setItem(this.id,0),this.setAttribute("hidden","hidden"),this.dispatchEvent(new CustomEvent("on:announcement-bar:dismiss"))}stopInteractions(){this.interactions=!1}resumeInteractions(){this.interactions=!0}#o(){this.slidesWidth=0,this.containerWidth=.89*window.innerWidth;const{carouselSlides:e}=this;e.forEach((e=>{const t=e.querySelector(".announcement__message"),s=e.querySelector(".announcement__text"),i=window.getComputedStyle(t),n=s.offsetWidth+parseFloat(i.paddingLeft)+parseFloat(i.paddingRight);this.slidesWidth+=n})),this.slidesWrap=this.slidesWidth>this.containerWidth}#r(){const e=!this.staticDisplay;this.carouselContainer.classList.toggle("announcement__container--carousel",e),this.carouselWrapper.classList.toggle("announcement__wrapper--carousel",e),this.carouselSlides.forEach((t=>{t.classList.toggle("announcement__slides--carousel",e)})),this.carouselPrevBtn&&this.carouselNextBtn&&(this.carouselPrevBtn.toggleAttribute("hidden",!e),this.carouselNextBtn.toggleAttribute("hidden",!e))}#i(){if(this.staticDisplay)this.carouselContainer.style.maxWidth="100%";else{const e=Math.max(...Array.from(this.carouselSlides).map((e=>e.querySelector(".announcement__text").offsetWidth))),t=180;this.carouselContainer.style.maxWidth=`${e+t}px`}}#n(){this.closeBtn=document.createElement("button"),this.closeBtn.classList.add("announcement__close"),this.closeBtn.setAttribute("aria-label","Close Announcement Bar"),this.closeBtn.append(document.getElementById("template-icon-close").content.cloneNode(!0).firstElementChild),this.wrapper.append(this.closeBtn),this.closeBtn.addEventListener("click",this.dismiss.bind(this))}#s(){this.carouselPrevBtn=document.createElement("button"),this.carouselPrevBtn.classList.add("announcement__carousel-button","carousel-prev"),this.carouselPrevBtn.setAttribute("aria-label","Previous Announcement");const e=document.getElementById("template-icon-chevron").content.cloneNode(!0).firstElementChild;e.classList.add("icon--left"),this.carouselPrevBtn.append(e),this.carouselContainer.prepend(this.carouselPrevBtn),this.carouselNextBtn=document.createElement("button"),this.carouselNextBtn.classList.add("announcement__carousel-button","carousel-next"),this.carouselNextBtn.setAttribute("aria-label","Next Announcement");const t=document.getElementById("template-icon-chevron").content.cloneNode(!0).firstElementChild;this.carouselNextBtn.append(t),this.carouselContainer.append(this.carouselNextBtn),this.carouselPrevBtn.addEventListener("click",(()=>this.showPrevSlide())),this.carouselNextBtn.addEventListener("click",(()=>this.showNextSlide()))}#t(e){"on:popup:opening"===e.type?(this.setAttribute("popup-open",""),this.stopAutoplay()):"on:popup:closed"===e.type&&(this.removeAttribute("popup-open",""),this.startAutoplay())}}customElements.define("announcement-bar",AnnouncementBar);
//# sourceMappingURL=announcement-bar.js.map
