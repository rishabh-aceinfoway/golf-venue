import Player,{YoutubeProvider,VimeoProvider}from"vlite";const VIDEO_TYPES=["html5","youtube","vimeo"];Player.registerProvider("youtube",YoutubeProvider),Player.registerProvider("vimeo",VimeoProvider);class VideoPlayer extends HTMLElement{#e;#t=!1;#i=!1;#s=!1;#o;#n=null;#r;#l;#d=!1;#a;#h;constructor(){super(),this.#e=this.play.bind(this)}connectedCallback(){if(this.#a=this.dataset.type,!this.#a||!VIDEO_TYPES.includes(this.#a))throw new Error('Video type must be provided and one of: "html5", "Youtube", "Vimeo"');this.#h=this.querySelector("video-element"),this.#o=this.querySelector("video-loading-indicator"),this.#l=this.dataset.poster,this.#r=this.querySelector("video-poster"),this.#r&&(this.#r.addEventListener("click",this.loadContent.bind(this),{once:!0}),"vimeo"===this.#a&&this.#p())}disconnectedCallback(){this.#s=!1,this.#n&&(this.#n.destroy(),this.#n=null,this.#t=!1,this.#h.innerHTML="",this.removeAttribute("loaded")),this.#d&&(this.removeEventListener("on:video-player:play",this.#d),this.#d=null),this.#o&&this.#o.setAttribute("hidden","")}get ready(){return this.#t}loadContent(){if(this.hasAttribute("loaded")||this.#s)return this;this.#h.appendChild(this.querySelector("template").content.firstElementChild.cloneNode(!0));const e=this.querySelector("[video-element]");if(!e)throw new Error("Video element not found");this.#o&&this.#o.removeAttribute("hidden","");const t=()=>{new Player(e,{options:{autoHide:!0,...this.#l?{poster:this.#l}:{}},provider:this.#a,onReady:e=>{this.#n=e,this.#t=!0,this.#s=!1,this.setAttribute("loaded",""),this.#o&&this.#o.setAttribute("hidden","");const t=this.querySelector(".v-bigPlay");if(t){const e=document.getElementById("template-icon-play").content;t.innerHTML="",t.appendChild(e.cloneNode(!0))}this.#n.on("play",(()=>{this.#i=!0,this.classList.add("is-playing"),this.#r&&this.#r.classList.add("is-hidden"),this.dispatchEvent(new CustomEvent("on:video-player:playing"))})),this.#n.on("pause",(()=>{this.#i=!1,this.classList.remove("is-playing"),this.dispatchEvent(new CustomEvent("on:video-player:paused"))})),this.#n.on("ended",(()=>{this.#i=!1,this.classList.remove("is-playing"),this.dispatchEvent(new CustomEvent("on:video-player:ended"))})),this.dispatchEvent(new CustomEvent("on:video-player:ready"))}})};if("vimeo"===this.#a&&this.#r.dataset.videoId&&0===this.#r.children.length&&void 0===this.#l){const e=setInterval((()=>{"string"==typeof this.#l&&(t(),clearInterval(e))}),50)}else t();return this}play(){return this.#i||(this.#n?(this.#d=!1,this.#n.play()):this.#d||(this.#d=!0,this.addEventListener("on:video-player:ready",this.#e,{once:!0}))),this}pause(){return this.#i?(this.#n?this.#n.pause():this.#d&&(this.#d=!1,this.removeEventListener("on:video-player:ready",this.#e)),this):this}on(e,t,i){return this.addEventListener(e,t,i),this}off(e,t,i){return this.removeEventListener(e,t,i),this}async#p(){if(this.#r&&this.#r.dataset.videoId&&0===this.#r.children.length)try{const e=await fetch(`https://vimeo.com/api/v2/video/${this.#r.dataset.videoId}.json`),[t]=await e.json(),{thumbnail_large:i}=t;this.#l=i,this.#r.innerHTML=`<img src="${i}">`}catch(e){this.#l="",console.error(`Could not load Vimeo poster: ${e}`)}}}customElements.define("video-player",VideoPlayer);
//# sourceMappingURL=video-player.js.map
