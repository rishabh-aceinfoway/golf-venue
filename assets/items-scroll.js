import{BREAKPOINTS,debounce}from"utils";class ItemsScroll extends HTMLElement{items;scrollBar;scrollBarTrack;navigationContainer;navigationPrevButton;navigationNextButton;pageNavigationContainer;#t;#e;#i;#s;#n;#o;#r;#a=!1;#l=0;#h;#c;#d;#u;static observedAttributes=["scrollable"];constructor(){super(),this.items=this.querySelector("[data-items]"),this.breakpointMin=Object.keys(BREAKPOINTS).includes(this.getAttribute("breakpoint-min"))?BREAKPOINTS[this.getAttribute("breakpoint-min")]:Number(this.getAttribute("breakpoint-min")||"0"),this.breakpointMax=Object.keys(BREAKPOINTS).includes(this.getAttribute("breakpoint-max"))?BREAKPOINTS[this.getAttribute("breakpoint-max")]:Number(this.getAttribute("breakpoint-max")||"Infinity"),this.pageNavigationWrapper=null,this.navigationContainer=null,this.navigationPrevButton=null,this.navigationNextButton=null,this.snap=this.getAttribute("snap"),this.#o=null,this.#r=null,this.#n=!1,this.#h=null,this.#c=null,this.#d=null,this.#e=this.#v.bind(this),this.#i=this.#m.bind(this)}connectedCallback(){if(!this.items)throw Error("Items container missing");this.#l=this.items.scrollLeft,this.#d=new ResizeObserver(debounce((()=>{this.#g()})),50),this.#d.observe(this.items),this.#h||this.#b(),this.#c||this.#p(),this.#u=this.getAttribute("image-container-ratio"),this.items.addEventListener("scroll",this.#e,{once:!0}),this.items.addEventListener("scrollend",this.#i)}disconnectedCallback(){this.items.removeEventListener("scroll",this.#e),this.items.removeEventListener("scrollend",this.#i),this.#h&&(this.#h.disconnect(),this.#h=null),this.#c&&(this.#c.disconnect(),this.#c=null),this.#d&&(this.#d.disconnect(),this.#d=null)}attributeChangedCallback(t,e,i){"scrollable"===t&&e!==i&&this.dispatchEvent(new CustomEvent("on:items-scroll:change-state",{detail:{scrollable:this.hasAttribute("scrollable")}}))}get isNavigating(){return this.#a}get itemAtScroll(){return this.#S()}get itemsPerPage(){return this.#s}#S(){const t=window.getComputedStyle(this.items),e=Number(t.getPropertyValue("column-gap").replace("px","")),i=window.getComputedStyle(this.items.firstElementChild),s=Number(i.getPropertyValue("margin-left").replace("px","")),n=Number(i.getPropertyValue("margin-right").replace("px",""));return Array.from(this.items.children)[Math.round(this.items.scrollLeft/(s+this.items.firstElementChild.getBoundingClientRect().width+n+e))]}#f(){const t=document.createElement("div");t.classList.add("navigation"),t.innerHTML='\n      <button type="button" class="navigation__button navigation__button--prev" data-navigation-prev aria-label="Previous page"></button>\n      <button type="button" class="navigation__button navigation__button--next" data-navigation-next aria-label="Next page"></button>\n    ',this.appendChild(t),this.navigationContainer=t,this.navigationPrevButton=t.querySelector("[data-navigation-prev]"),this.navigationNextButton=t.querySelector("[data-navigation-next]");const e=document.getElementById("template-icon-chevron").content.cloneNode(!0).firstElementChild;e.classList.add("icon--left"),this.navigationPrevButton.append(e);const i=document.getElementById("template-icon-chevron").content.cloneNode(!0).firstElementChild;this.navigationNextButton.append(i)}#N(t){if(t.preventDefault(),this.#a)return;const e=this.#S().previousElementSibling;e&&this.smoothScrollItems(e.offsetLeft)}#C(t){if(t.preventDefault(),this.#a)return;const e=this.#S().nextElementSibling;e&&this.smoothScrollItems(e.offsetLeft)}#v(){const t=this.items.scrollLeft>this.#l?"FORWARD":"BACKWARD";this.#a=!0,this.classList.add("is-scrolling"),this.dispatchEvent(new CustomEvent("on:items-scroll:scroll-start",{detail:{direction:t}}))}#m(){const t=this.items.scrollLeft,e=t>this.#l?"FORWARD":"BACKWARD";this.#a=!1,this.classList.remove("is-scrolling"),this.dispatchEvent(new CustomEvent("on:items-scroll:scroll-end",{detail:{direction:e,position:t}})),this.#l=t,this.items.addEventListener("scroll",this.#e,{once:!0})}#E(){this.#n||(this.#o=this.#N.bind(this),this.#r=this.#C.bind(this),this.navigationPrevButton.addEventListener("click",this.#o),this.navigationNextButton.addEventListener("click",this.#r),this.#n=!0)}#A(){this.#n&&(this.navigationPrevButton.removeEventListener("click",this.#o),this.navigationNextButton.removeEventListener("click",this.#r),this.#n=!1)}#g(){const t=(t,e)=>{const[i,s]=t.split(":").map((t=>Number(t))),n=Number(window.getComputedStyle(this.items).getPropertyValue("column-gap").replace("px","")||0),o=(t,e)=>e?o(e,t%e):t,r=o(s,Math.round(this.items.offsetHeight));return`${i*e*Math.round(this.items.offsetHeight)/r+n*(e-1)*s/r} / ${s*Math.round(this.items.offsetHeight)/r}`};if(this.items.children.length>0){const t=Math.floor(this.items.offsetWidth/this.items.children[0].offsetWidth);t&&(this.#s=t)}document.body.offsetWidth>this.breakpointMin&&document.body.offsetWidth<=this.breakpointMax?this.setAttribute("scroll-enabled",""):this.removeAttribute("scroll-enabled"),this.hasAttribute("scroll-enabled")&&this.items.scrollWidth>this.items.offsetWidth+10?(this.setAttribute("scrollable",""),this.navigationContainer||this.#f(),this.snap||(this.items.children.length>0&&this.items.children[0].offsetWidth>this.items.offsetWidth/2?this.setAttribute("snap","center"):this.setAttribute("snap","start")),this.#E()):(this.navigationContainer&&this.#A(),this.removeAttribute("scrollable","")),this.#u&&"natural"!==this.#u.toLowerCase()&&this.style.setProperty("--navigation-ratio",t(this.#u,this.#s)),this.items.classList.contains("grid-layout")&&(this.items.children.length<this.#s?this.items.classList.add("grid-layout--align-center"):this.items.classList.remove("grid-layout--align-center"))}#p(){this.#c=new MutationObserver((t=>{t.forEach((t=>{"childList"===t.type&&(this.#g(),this.#b())}))})),this.#c.observe(this.items,{attributes:!1,childList:!0,subtree:!1})}#b(){if(!this.items.firstElementChild)return;const t={root:this.items,rootMargin:"0px",threshold:.75};this.#h&&this.#h.disconnect(),this.#h=new IntersectionObserver((t=>{this.navigationContainer&&t.forEach((({target:t,isIntersecting:e})=>{t.previousElementSibling||(this.navigationPrevButton.disabled=e),t.nextElementSibling||(this.navigationNextButton.disabled=e)}))}),t),this.#h.observe(this.items.firstElementChild),this.#h.observe(this.items.lastElementChild)}smoothScrollItems(t){return new Promise(((e,i)=>{let s=0,n=null;const o=()=>{const r=this.items.scrollLeft;if(this.#t)return i(r);if(r===n){if(s+=1,s>2)return e(t)}else s=0,n=r;return window.requestAnimationFrame(o),null};this.items.scrollTo({left:t,behavior:window.matchMedia("(prefers-reduced-motion: reduce)").matches?"instant":"smooth"}),window.requestAnimationFrame(o)}))}}customElements.define("items-scroll",ItemsScroll);export default ItemsScroll;
//# sourceMappingURL=items-scroll.js.map
